

[include Fan-Control.cfg]
# [include BTT-Sensorless-Homing.cfg]
[include K1-Style-Sensorless.cfg]
[include Pucci_Macros.cfg]
[include printer_params.cfg]
[include shell_command.cfg]
[include Demon_BTT_Eddy_Offset.cfg]

[include camera-control.cfg]

[include Start_Pause_Cancel_End/Line_Purge.cfg]
[include Start_Pause_Cancel_End/Pucci_Smart_Park.cfg]
[include Start_Pause_Cancel_End/Start.cfg]
[include Start_Pause_Cancel_End/Clean_Nozzle.cfg]
[include Start_Pause_Cancel_End/Pucci-mainsail.cfg]

[exclude_object]
[pause_resume]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_45000E000B504B5735313920-if00

[mcu Nozzle_MCU]
serial: /dev/serial/by-path/platform-xhci-hcd.4.auto-usb-0:1.2.2:1.0-port0
baud: 230400
restart_method: command

# host MCU service is preinstalled and ready to use with:
[mcu CB2]
serial: /tmp/klipper_host_mcu

[temperature_sensor Manta_E3EZ]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[verify_heater extruder]

[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[virtual_sdcard]
path: /home/biqu/printer_data/gcodes

[gcode_arcs]
resolution: 0.3

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: Nozzle_MCU:PB1
dir_pin: Nozzle_MCU:PB0
enable_pin: !Nozzle_MCU:PB2
microsteps: 16
# gear_ratio: 6.25:1
# rotation_distance: 44.17725 #with gear ratio
#rotation_distance: 4.6212342 <------ Libra
rotation_distance: 6.7965 #<---- Original (stable state)
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: Nozzle_MCU:PB7
sensor_type:Generic 3950 #EPCOS 100K B57560G104F
sensor_pin: Nozzle_MCU:PA0
pressure_advance: 0.04
pressure_advance_smooth_time: 0.027
#control: pid
#pid_kp: 24.373
#pid_ki: 2.196
#pid_kd: 67.634
min_temp: 0
max_temp: 315

[tmc2209 extruder]
uart_pin: Nozzle_MCU:PB11
tx_pin: Nozzle_MCU:PB10
uart_address: 3
run_current: 0.53
# run_current: 0.7 #bondtech extruder <----------Libra
sense_resistor: 0.150
stealthchop_threshold: 0
# interpolate: False
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

############################## AUTO-TUNE ################################

# [autotune_tmc stepper_x]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [autotune_tmc stepper_y]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [motor_constants Pucci-X-Y-Motors]
# # Coil resistance, Ohms
# resistance: 1.2
# # Coil inductance, Henries
# inductance: 0.0015
# # Holding torque, Nm
# holding_torque: 0.45
# # Nominal rated current, Amps
# max_current: 2.5
# # Steps per revolution (1.8deg motors use 200, 0.9deg motors use 400)
# steps_per_revolution: 400

############################## ^^ AUTO-TUNE ^^ ################################

[stepper_x]
dir_pin: PA10
step_pin: PA14
enable_pin: !PA13
microsteps: 16 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 305.90
position_min: -2
position_max: 305.90
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PB8
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PC4
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118


[stepper_y]
dir_pin: PA15 #!
step_pin: PC8
enable_pin: !PC14
microsteps: 16 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -1
position_min: -1
position_max: 295
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PC9
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PB0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118

[stepper_z]
step_pin: PD2
dir_pin: !PD4
enable_pin: !PD3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin:probe:z_virtual_endstop   #probe:z_virtual_endstop
# position_endstop: 0
position_max: 293
position_min: -5
homing_speed: 10
homing_retract_dist: 0
second_homing_speed: 5
homing_retract_speed: 10


[tmc2209 stepper_z]
uart_pin: PD0
run_current: 0.8
diag_pin: PC6
interpolate: False
# stealthchop_threshold: 0
sense_resistor: 0.110
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
# driver_SGTHRS: 0

[heater_bed]
heater_pin: PC7
sensor_type: NTC 100K MGB18-104F39050L32 #default: EPCOS 100K B57560G104F
sensor_pin: PA3
#control: pid
#pid_kp: 44.227
#pid_ki: 0.553
#pid_kd: 883.995
min_temp: 0
max_temp: 118
# pwm_cycle_time: 0.02088 # 47.9Hz #setting in bed slinger - pwm_cycle_time: 0.01666
pwm_cycle_time: 0.01666



# [bed_mesh]
# speed: 150
# mesh_min: 5,5
# mesh_max: 285,280
# probe_count: 6,6
# fade_start: 5.0
# fade_end: 50.0

[input_shaper]
#shaper_freq_x: 95.8 # center frequency for the X axis filter
#shaper_type_x: 3hump_ei # filter type for the X axis
#shaper_freq_y: 47.4 # center frequency for the Y axis filter
#shaper_type_y: mzv # filter type for the Y axis
damping_ratio_x: 0.058 # damping ratio for the X axis
damping_ratio_y: 0.058 # damping ratio for the Y axis


[adxl345]
cs_pin: Nozzle_MCU:PA4
spi_speed: 5000000
axes_map: x,-z,y #<--Current
# axes_map: x, -z, -y

spi_software_sclk_pin: Nozzle_MCU:PA5
spi_software_mosi_pin: Nozzle_MCU:PA7
spi_software_miso_pin: Nozzle_MCU:PA6

[resonance_tester]
accel_chip: adxl345
# accel_per_hz: 75
probe_points:
   150,150,25

[shaketune]
result_folder: /home/biqu/printer_data/config/Shaketune_results/ #~/home/biqu/printer_date/ShakeTune_results
number_of_results_to_keep: 5
keep_raw_data: False
show_macros_in_webui: True
timeout: 600
measurements_chunk_size: 2
max_freq: 200
dpi: 300

[filament_switch_sensor filament_sensor] # Stock filament sensor
pause_on_runout: true
switch_pin: PC15


[display_status]

[printer]
kinematics: corexy
max_velocity:600
max_accel:25000
minimum_cruise_ratio:0.2
max_z_velocity:20
square_corner_velocity:25
max_z_accel:300


[pause_resume]


[firmware_retraction]
retract_length: 0.1
retract_speed: 35
unretract_extra_length: 0
unretract_speed: 35

[include moonraker_obico_macros.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3284004.522,0.089844:3281828.686,0.129688:3279745.569,
#*# 	0.170313:3277650.706,0.210156:3275712.794,0.250000:3273724.837,
#*# 	0.289844:3271807.425,0.329688:3269917.421,0.370313:3268058.188,
#*# 	0.410156:3266268.201,0.450000:3264477.938,0.489844:3262734.627,
#*# 	0.529688:3261019.108,0.570313:3259343.823,0.610156:3257716.211,
#*# 	0.650000:3256139.021,0.689844:3254557.863,0.729688:3253053.126,
#*# 	0.770313:3251526.650,0.810156:3250040.495,0.850000:3248541.403,
#*# 	0.889844:3247101.889,0.929688:3245670.641,0.970313:3244243.315,
#*# 	1.010156:3242813.786,1.050000:3241387.619,1.089844:3239996.402,
#*# 	1.129688:3238646.600,1.170313:3237284.803,1.210156:3235883.124,
#*# 	1.250000:3234570.136,1.289844:3233281.992,1.329688:3231985.817,
#*# 	1.370313:3230732.514,1.410156:3229490.790,1.450000:3228298.286,
#*# 	1.489844:3227075.677,1.529688:3225862.911,1.570313:3224695.597,
#*# 	1.610156:3223546.583,1.650000:3222415.961,1.689844:3221279.188,
#*# 	1.729688:3220183.817,1.770313:3219112.059,1.810156:3218053.286,
#*# 	1.850000:3217046.109,1.889844:3216033.947,1.929688:3215074.979,
#*# 	1.970313:3214103.654,2.010156:3213136.911,2.050000:3212233.715,
#*# 	2.089844:3211326.724,2.129688:3210445.508,2.170313:3209547.108,
#*# 	2.210156:3208688.848,2.250000:3207809.547,2.289844:3206983.687,
#*# 	2.329688:3206141.351,2.370313:3205322.222,2.410156:3204503.796,
#*# 	2.450000:3203717.145,2.489844:3202954.818,2.529688:3202190.375,
#*# 	2.570313:3201472.467,2.610156:3200727.861,2.650000:3199994.094,
#*# 	2.689844:3199284.532,2.729688:3198603.846,2.770313:3197926.746,
#*# 	2.810156:3197254.993,2.850000:3196618.039,2.889844:3195968.125,
#*# 	2.929688:3195361.596,2.970313:3194744.395,3.010156:3194114.106,
#*# 	3.050000:3193550.534,3.089844:3192965.641,3.129688:3192373.794,
#*# 	3.170313:3191801.332,3.210156:3191243.104,3.250000:3190660.635,
#*# 	3.289844:3190130.850,3.329688:3189610.820,3.370313:3189078.630,
#*# 	3.410156:3188612.366,3.450000:3188112.931,3.489844:3187620.539,
#*# 	3.529688:3187144.490,3.570313:3186670.441,3.610156:3186226.784,
#*# 	3.650000:3185777.823,3.689844:3185339.400,3.729688:3184943.848,
#*# 	3.770313:3184500.271,3.810156:3184079.332,3.850000:3183668.446,
#*# 	3.889844:3183289.994,3.929688:3182894.668,3.970313:3182517.550,
#*# 	4.010156:3182141.674,4.050000:3181780.461
#*# calibration_temp = 33.678266
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 47.031860
#*# drift_calibration =
#*# 	3360644.758879, -2820.886709, 20.141917
#*# 	3312116.106386, -1917.541853, 13.291273
#*# 	3280785.269079, -1452.005080, 9.942133
#*# 	3254641.870347, -1078.779883, 7.344739
#*# 	3233018.012279, -766.656043, 5.120839
#*# 	3217331.514063, -566.449453, 3.719500
#*# 	3206315.982398, -447.902915, 2.893839
#*# 	3196462.484480, -315.789872, 1.917750
#*# 	3188997.100504, -225.906942, 1.284198
#*# drift_calibration_min_temp = 56.23536910126953
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.214465, -0.228544, -0.230817, -0.233995, -0.242534, -0.233984, -0.233385, -0.234314, -0.231601, -0.237020, -0.235447, -0.229068, -0.217559, -0.194050
#*# 	  -0.200036, -0.219731, -0.216138, -0.218820, -0.211745, -0.203003, -0.192731, -0.186066, -0.179571, -0.182128, -0.181773, -0.179985, -0.174787, -0.163794
#*# 	  -0.174794, -0.181285, -0.178401, -0.173449, -0.165340, -0.152233, -0.141822, -0.135099, -0.125972, -0.129225, -0.131826, -0.132298, -0.137433, -0.119251
#*# 	  -0.141556, -0.151725, -0.142532, -0.134028, -0.125353, -0.105923, -0.097404, -0.086600, -0.077863, -0.083476, -0.081833, -0.083864, -0.087867, -0.077725
#*# 	  -0.105793, -0.112510, -0.105039, -0.094177, -0.080303, -0.066922, -0.058591, -0.049429, -0.047665, -0.050906, -0.050615, -0.054717, -0.049701, -0.044302
#*# 	  -0.098426, -0.100340, -0.092964, -0.074497, -0.056995, -0.041675, -0.030209, -0.026550, -0.024803, -0.027620, -0.022825, -0.030075, -0.020181, -0.036027
#*# 	  -0.078027, -0.074288, -0.059693, -0.036592, -0.021727, -0.006001, 0.002491, 0.004288, 0.005195, -0.000278, 0.002277, 0.001941, -0.001164, -0.002682
#*# 	  -0.052633, -0.051671, -0.045651, -0.027369, -0.004890, 0.008650, 0.022055, 0.030973, 0.030333, 0.026263, 0.030163, 0.031406, 0.027874, 0.014684
#*# 	  -0.037480, -0.026441, -0.024191, -0.009660, 0.003191, 0.020839, 0.034671, 0.042227, 0.052868, 0.040346, 0.045558, 0.042124, 0.035858, 0.019891
#*# 	  -0.022628, -0.013794, -0.016345, -0.011567, 0.004638, 0.024691, 0.040316, 0.048791, 0.063843, 0.063104, 0.059411, 0.066176, 0.050157, 0.035533
#*# 	  -0.027922, -0.022061, -0.014952, -0.008924, 0.010257, 0.026673, 0.040789, 0.050331, 0.066286, 0.067680, 0.067229, 0.054815, 0.046256, 0.035480
#*# 	  -0.028000, -0.020866, -0.023424, -0.018583, 0.007705, 0.027716, 0.041351, 0.054697, 0.064337, 0.067716, 0.063170, 0.059346, 0.042528, 0.028259
#*# 	  -0.025696, -0.022914, -0.011528, 0.004099, 0.031376, 0.048998, 0.072259, 0.075694, 0.080255, 0.072818, 0.064256, 0.051384, 0.029920, 0.020893
#*# 	  -0.035777, -0.030407, -0.019122, 0.004095, 0.031840, 0.057930, 0.066649, 0.070282, 0.076185, 0.061610, 0.051688, 0.039078, 0.023523, 0.004464
#*# 	  -0.051273, -0.026470, -0.012241, 0.008084, 0.031007, 0.042340, 0.044331, 0.050116, 0.043936, 0.031842, 0.018037, 0.007007, -0.005329, -0.020716
#*# 	  -0.049170, -0.029223, -0.009199, -0.005582, 0.007470, 0.012285, 0.018334, 0.011936, 0.016718, 0.000794, -0.001663, -0.013682, -0.026717, -0.043869
#*# 	  -0.059109, -0.042057, -0.034842, -0.023893, -0.018620, -0.008976, -0.008696, -0.012049, -0.014019, -0.023807, -0.025538, -0.034310, -0.049439, -0.066164
#*# 	  -0.082917, -0.081983, -0.075220, -0.067574, -0.060663, -0.047805, -0.044206, -0.046105, -0.046019, -0.057057, -0.052092, -0.058331, -0.080959, -0.104116
#*# x_count = 14
#*# y_count = 18
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 280.0
#*# min_y = 24.0
#*# max_y = 274.91999999999996
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 98.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 48.6
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 43.970
#*# pid_ki = 1.192
#*# pid_kd = 405.626
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.069098, -0.009833, -0.059265
#*# compensation_start_x = 20.0
#*# compensation_end_x = 280.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 27.982
#*# pid_ki = 2.275
#*# pid_kd = 86.042
