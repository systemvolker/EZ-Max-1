

[include Fan-Control.cfg]
# [include BTT-Sensorless-Homing.cfg]
[include K1-Style-Sensorless.cfg]
[include Pucci_Macros.cfg]
[include printer_params.cfg]
[include shell_command.cfg]
[include Demon_BTT_Eddy_Offset.cfg]

[include Start_Pause_Cancel_End/Line_Purge.cfg]
[include Start_Pause_Cancel_End/Pucci_Smart_Park.cfg]
[include Start_Pause_Cancel_End/Start.cfg]
[include Start_Pause_Cancel_End/Clean_Nozzle.cfg]
[include Start_Pause_Cancel_End/Pucci-mainsail.cfg]

[exclude_object]
[pause_resume]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_45000E000B504B5735313920-if00

[mcu Nozzle_MCU]
serial: /dev/serial/by-path/platform-xhci-hcd.4.auto-usb-0:1.2.2:1.0-port0
baud: 230400
restart_method: command

# host MCU service is preinstalled and ready to use with:
[mcu CB2]
serial: /tmp/klipper_host_mcu

[temperature_sensor Manta_E3EZ]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[verify_heater extruder]

[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[virtual_sdcard]
path: /home/biqu/printer_data/gcodes

[gcode_arcs]
resolution: 0.3

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: Nozzle_MCU:PB1
dir_pin: Nozzle_MCU:PB0
enable_pin: !Nozzle_MCU:PB2
microsteps: 16
# gear_ratio: 6.25:1
# rotation_distance: 44.17725 #with gear ratio
#rotation_distance: 4.6212342 <------ Libra
rotation_distance: 6.7965 #<---- Original (stable state)
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: Nozzle_MCU:PB7
sensor_type:Generic 3950 #EPCOS 100K B57560G104F
sensor_pin: Nozzle_MCU:PA0
pressure_advance: 0.04
pressure_advance_smooth_time: 0.027
#control: pid
#pid_kp: 24.373
#pid_ki: 2.196
#pid_kd: 67.634
min_temp: 0
max_temp: 320

[tmc2209 extruder]
uart_pin: Nozzle_MCU:PB11
tx_pin: Nozzle_MCU:PB10
uart_address: 3
run_current: 0.54
# run_current: 0.7 #bondtech extruder <----------Libra
sense_resistor: 0.150
interpolate: False
stealthchop_threshold: 0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

############################## AUTO-TUNE ################################

# [autotune_tmc stepper_x]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [autotune_tmc stepper_y]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [motor_constants Pucci-X-Y-Motors]
# # Coil resistance, Ohms
# resistance: 1.2
# # Coil inductance, Henries
# inductance: 0.0015
# # Holding torque, Nm
# holding_torque: 0.45
# # Nominal rated current, Amps
# max_current: 2.5
# # Steps per revolution (1.8deg motors use 200, 0.9deg motors use 400)
# steps_per_revolution: 400

############################## ^^ AUTO-TUNE ^^ ################################

[stepper_x]
dir_pin: PA10
step_pin: PA14
enable_pin: !PA13
microsteps: 16 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 305.90
position_min: -2
position_max: 305.90
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PB8
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PC4
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118


[stepper_y]
dir_pin: PA15 #!
step_pin: PC8
enable_pin: !PC14
microsteps: 16 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -1
position_min: -1
position_max: 295
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PC9
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PB0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118

[stepper_z]
step_pin: PD2
dir_pin: !PD4
enable_pin: !PD3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin:probe:z_virtual_endstop   #probe:z_virtual_endstop
# position_endstop: 0
position_max: 293
position_min: -5
homing_speed: 10
homing_retract_dist: 0
second_homing_speed: 5
homing_retract_speed: 10


[tmc2209 stepper_z]
uart_pin: PD0
run_current: 0.8
diag_pin: PC6
interpolate: False
# stealthchop_threshold: 0
sense_resistor: 0.110
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
# driver_SGTHRS: 0

[heater_bed]
heater_pin: PC7
sensor_type: NTC 100K MGB18-104F39050L32 #default: EPCOS 100K B57560G104F
sensor_pin: PA3
#control: pid
#pid_kp: 44.227
#pid_ki: 0.553
#pid_kd: 883.995
min_temp: 0
max_temp: 118
# pwm_cycle_time: 0.02088 # 47.9Hz #setting in bed slinger - pwm_cycle_time: 0.01666
pwm_cycle_time: 0.01666



# [bed_mesh]
# speed: 150
# mesh_min: 5,5
# mesh_max: 285,280
# probe_count: 6,6
# fade_start: 5.0
# fade_end: 50.0

[input_shaper]
#shaper_freq_x: 95.8 # center frequency for the X axis filter
#shaper_type_x: 3hump_ei # filter type for the X axis
#shaper_freq_y: 47.4 # center frequency for the Y axis filter
#shaper_type_y: mzv # filter type for the Y axis
damping_ratio_x: 0.058 # damping ratio for the X axis
damping_ratio_y: 0.058 # damping ratio for the Y axis


[adxl345]
cs_pin: Nozzle_MCU:PA4
spi_speed: 5000000
axes_map: x,-z,y #<--Current
# axes_map: x, -z, -y

spi_software_sclk_pin: Nozzle_MCU:PA5
spi_software_mosi_pin: Nozzle_MCU:PA7
spi_software_miso_pin: Nozzle_MCU:PA6

[resonance_tester]
accel_chip: adxl345
# accel_per_hz: 75
probe_points:
   150,150,25

[shaketune]
result_folder: /home/biqu/printer_data/config/Shaketune_results/ #~/home/biqu/printer_date/ShakeTune_results
number_of_results_to_keep: 5
keep_raw_data: False
show_macros_in_webui: True
timeout: 600
measurements_chunk_size: 2
max_freq: 200
dpi: 300

[filament_switch_sensor filament_sensor] # Stock filament sensor
pause_on_runout: true
switch_pin: PC15


[display_status]

[printer]
kinematics: corexy
max_velocity:600
max_accel:25000
minimum_cruise_ratio:0.2
max_z_velocity:20
square_corner_velocity:25
max_z_accel:300


[pause_resume]


[firmware_retraction]
retract_length: 0.1
retract_speed: 35
unretract_extra_length: 0
unretract_speed: 35

[include moonraker_obico_macros.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3266228.716,0.090039:3264552.029,0.130078:3262832.265,
#*# 	0.169922:3261174.005,0.209961:3259540.545,0.250000:3257934.345,
#*# 	0.290039:3256369.162,0.330078:3254784.238,0.369922:3253251.649,
#*# 	0.409961:3251706.362,0.450000:3250194.574,0.490039:3248673.969,
#*# 	0.530078:3247212.959,0.569922:3245717.991,0.609961:3244259.108,
#*# 	0.650000:3242788.013,0.690039:3241360.617,0.730078:3239969.383,
#*# 	0.769922:3238587.309,0.809961:3237226.376,0.850000:3235845.281,
#*# 	0.890039:3234532.656,0.930078:3233209.491,0.969922:3231944.899,
#*# 	1.009961:3230674.989,1.050000:3229425.514,1.090039:3228187.010,
#*# 	1.130078:3226976.141,1.169922:3225754.643,1.209961:3224600.736,
#*# 	1.250000:3223384.706,1.290039:3222230.616,1.330078:3221069.775,
#*# 	1.369922:3219966.585,1.409961:3218822.810,1.450000:3217761.777,
#*# 	1.490039:3216707.539,1.530078:3215645.771,1.569922:3214660.073,
#*# 	1.609961:3213668.436,1.650000:3212676.541,1.690039:3211667.220,
#*# 	1.730078:3210779.561,1.769922:3209890.292,1.809961:3208973.860,
#*# 	1.850000:3208095.521,1.890039:3207237.808,1.930078:3206403.081,
#*# 	1.969922:3205561.792,2.009961:3204759.645,2.050000:3203964.450,
#*# 	2.090039:3203151.550,2.130078:3202428.581,2.169922:3201693.863,
#*# 	2.209961:3200988.933,2.250000:3200253.895,2.290039:3199494.483,
#*# 	2.330078:3198814.450,2.369922:3198153.103,2.409961:3197473.744,
#*# 	2.450000:3196803.266,2.490039:3196181.349,2.530078:3195520.470,
#*# 	2.569922:3194910.318,2.609961:3194293.916,2.650000:3193701.128,
#*# 	2.690039:3193118.303,2.730078:3192536.313,2.769922:3191984.266,
#*# 	2.809961:3191417.387,2.850000:3190889.219,2.890039:3190351.235,
#*# 	2.930078:3189810.444,2.969922:3189278.689,3.009961:3188778.466,
#*# 	3.050000:3188277.858,3.090039:3187769.670,3.130078:3187273.499,
#*# 	3.169922:3186819.788,3.209961:3186379.298,3.250000:3185898.972,
#*# 	3.290039:3185460.150,3.330078:3185026.651,3.369922:3184616.615,
#*# 	3.409961:3184200.253,3.450000:3183770.012,3.490039:3183390.614,
#*# 	3.530078:3183000.412,3.569922:3182615.347,3.609961:3182238.370,
#*# 	3.650000:3181838.953,3.690039:3181483.968,3.730078:3181127.025,
#*# 	3.769922:3180757.411,3.809961:3180399.669,3.850000:3180051.277,
#*# 	3.890039:3179688.624,3.930078:3179366.255,3.969922:3179054.475,
#*# 	4.009961:3178739.834,4.050000:3178415.209
#*# calibration_temp = 33.678266
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 43.355395
#*# drift_calibration =
#*# 	3360644.758879, -2820.886709, 20.141917
#*# 	3312116.106386, -1917.541853, 13.291273
#*# 	3280785.269079, -1452.005080, 9.942133
#*# 	3254641.870347, -1078.779883, 7.344739
#*# 	3233018.012279, -766.656043, 5.120839
#*# 	3217331.514063, -566.449453, 3.719500
#*# 	3206315.982398, -447.902915, 2.893839
#*# 	3196462.484480, -315.789872, 1.917750
#*# 	3188997.100504, -225.906942, 1.284198
#*# drift_calibration_min_temp = 56.23536910126953
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.198310, -0.217315, -0.226329, -0.234045, -0.242918, -0.238791, -0.240797, -0.237773, -0.239347, -0.248279, -0.245795, -0.239195, -0.226562, -0.211829
#*# 	  -0.181522, -0.201824, -0.206610, -0.209514, -0.210075, -0.202289, -0.197399, -0.192557, -0.188991, -0.190351, -0.195195, -0.192715, -0.188434, -0.179698
#*# 	  -0.154995, -0.169623, -0.173291, -0.169549, -0.166719, -0.156697, -0.146601, -0.138953, -0.132814, -0.137434, -0.141111, -0.142825, -0.144905, -0.134282
#*# 	  -0.122235, -0.132914, -0.128931, -0.126592, -0.120454, -0.107009, -0.097782, -0.088318, -0.086672, -0.092092, -0.092601, -0.099005, -0.100357, -0.096449
#*# 	  -0.096993, -0.099456, -0.097161, -0.083879, -0.077869, -0.064826, -0.059373, -0.050374, -0.055812, -0.056598, -0.063759, -0.063203, -0.063733, -0.060092
#*# 	  -0.076601, -0.080975, -0.075133, -0.065626, -0.050485, -0.041818, -0.031338, -0.028503, -0.034652, -0.033302, -0.039131, -0.046740, -0.040382, -0.052669
#*# 	  -0.054040, -0.054947, -0.047151, -0.029416, -0.023251, -0.008679, -0.004114, -0.001456, -0.006283, -0.011592, -0.010530, -0.020581, -0.016688, -0.024150
#*# 	  -0.029866, -0.027705, -0.026036, -0.018888, -0.004737, 0.008028, 0.012209, 0.022326, 0.017561, 0.010123, 0.009891, 0.011767, 0.005849, 0.004950
#*# 	  -0.012656, -0.018383, -0.016603, -0.003852, 0.006876, 0.018436, 0.034415, 0.034686, 0.035200, 0.028118, 0.027686, 0.020231, 0.020037, 0.014810
#*# 	  -0.001934, 0.008858, -0.016281, -0.004831, 0.000530, 0.016833, 0.027858, 0.037788, 0.042422, 0.041584, 0.036431, 0.040347, 0.024735, 0.015345
#*# 	  -0.008051, -0.012013, -0.016250, -0.006772, 0.003540, 0.020286, 0.027452, 0.035285, 0.047646, 0.048908, 0.044513, 0.036444, 0.026908, 0.014819
#*# 	  -0.006206, -0.019428, -0.023984, -0.025007, -0.003378, 0.011559, 0.025595, 0.029420, 0.045067, 0.046723, 0.043078, 0.030751, 0.023365, 0.006321
#*# 	  -0.024193, -0.028449, -0.027617, -0.007049, 0.004083, 0.028668, 0.038600, 0.045770, 0.048323, 0.045823, 0.035036, 0.025988, 0.005255, -0.007445
#*# 	  -0.038159, -0.039880, -0.031379, -0.018311, 0.004795, 0.025718, 0.039734, 0.043731, 0.045006, 0.032322, 0.031067, 0.012565, -0.004740, -0.022257
#*# 	  -0.062276, -0.054456, -0.034173, -0.020213, 0.006983, 0.022548, 0.030582, 0.027804, 0.025390, 0.009914, 0.001353, -0.014994, -0.030185, -0.048777
#*# 	  -0.081970, -0.059775, -0.043836, -0.034815, -0.023718, -0.013328, -0.011185, -0.013468, -0.012359, -0.023431, -0.031591, -0.045563, -0.064229, -0.081822
#*# 	  -0.091554, -0.071570, -0.051327, -0.049235, -0.038997, -0.037153, -0.034214, -0.041605, -0.038653, -0.054741, -0.064262, -0.066004, -0.088153, -0.107565
#*# 	  -0.103592, -0.101213, -0.095493, -0.091227, -0.078430, -0.074939, -0.069759, -0.079633, -0.081898, -0.086193, -0.085618, -0.096884, -0.112163, -0.135066
#*# x_count = 14
#*# y_count = 18
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 280.0
#*# min_y = 24.0
#*# max_y = 265.90999999999997
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 98.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 48.6
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 43.970
#*# pid_ki = 1.192
#*# pid_kd = 405.626
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.069098, -0.009833, -0.059265
#*# compensation_start_x = 20.0
#*# compensation_end_x = 280.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 41.683
#*# pid_ki = 10.688
#*# pid_kd = 40.640
