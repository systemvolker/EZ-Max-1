

[include Fan-Control.cfg]
# [include BTT-Sensorless-Homing.cfg]
[include K1-Style-Sensorless.cfg]
[include Pucci_Macros.cfg]
[include printer_params.cfg]
[include shell_command.cfg]
[include Demon_BTT_Eddy_Offset.cfg]

[include Start_Pause_Cancel_End/Line_Purge.cfg]
[include Start_Pause_Cancel_End/Pucci_Smart_Park.cfg]
[include Start_Pause_Cancel_End/Start.cfg]
[include Start_Pause_Cancel_End/Clean_Nozzle.cfg]
[include Start_Pause_Cancel_End/Pucci-mainsail.cfg]

[exclude_object]
[pause_resume]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_45000E000B504B5735313920-if00

[mcu Nozzle_MCU]
serial: /dev/serial/by-path/platform-xhci-hcd.4.auto-usb-0:1.2.2:1.0-port0
baud: 230400
restart_method: command

# host MCU service is preinstalled and ready to use with:
[mcu CB2]
serial: /tmp/klipper_host_mcu

[temperature_sensor Manta_E3EZ]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[verify_heater extruder]

[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[virtual_sdcard]
path: /home/biqu/printer_data/gcodes

[gcode_arcs]
resolution: 0.12

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: Nozzle_MCU:PB1
dir_pin: Nozzle_MCU:PB0
enable_pin: !Nozzle_MCU:PB2
microsteps: 16
rotation_distance: 4.6212342
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: Nozzle_MCU:PB7
sensor_type: EPCOS 100K B57560G104F
sensor_pin: Nozzle_MCU:PA0
pressure_advance: 0.04
pressure_advance_smooth_time: 0.027
control: pid
pid_kp: 24.373
pid_ki: 2.196
pid_kd: 67.634
min_temp: 0
max_temp: 320

[tmc2209 extruder]
uart_pin: Nozzle_MCU:PB11
tx_pin: Nozzle_MCU:PB10
uart_address: 3
run_current: 0.7 #bondtech extruder
sense_resistor: 0.110
interpolate: False
stealthchop_threshold: 0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

############################## AUTO-TUNE ################################

# [autotune_tmc stepper_x]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [autotune_tmc stepper_y]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [motor_constants Pucci-X-Y-Motors]
# # Coil resistance, Ohms
# resistance: 1.2
# # Coil inductance, Henries
# inductance: 0.0015
# # Holding torque, Nm
# holding_torque: 0.45
# # Nominal rated current, Amps
# max_current: 2.5
# # Steps per revolution (1.8deg motors use 200, 0.9deg motors use 400)
# steps_per_revolution: 400

############################## ^^ AUTO-TUNE ^^ ################################

[stepper_x]
dir_pin: PA10
step_pin: PA14
enable_pin: !PA13
microsteps: 64 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 305.90
position_min: -2
position_max: 305.90
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PB8
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PC4
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118


[stepper_y]
dir_pin: PA15 #!
step_pin: PC8
enable_pin: !PC14
microsteps: 64 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -1
position_min: -1
position_max: 286
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PC9
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PB0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118

[stepper_z]
step_pin: PD2
dir_pin: !PD4
enable_pin: !PD3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin:probe:z_virtual_endstop   #probe:z_virtual_endstop
# position_endstop: 0
position_max: 300
position_min: -5
homing_speed: 10
homing_retract_dist: 0
second_homing_speed: 5
homing_retract_speed: 10


[tmc2209 stepper_z]
uart_pin: PD0
run_current: 0.8
diag_pin: PC6
# stealthchop_threshold: 0
sense_resistor: 0.110
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
# driver_SGTHRS: 0

[heater_bed]
heater_pin: PC7
sensor_type: NTC 100K MGB18-104F39050L32 #default: EPCOS 100K B57560G104F
sensor_pin: PA3
#control: pid
#pid_kp: 44.227
#pid_ki: 0.553
#pid_kd: 883.995
min_temp: 0
max_temp: 118
# pwm_cycle_time: 0.02088 # 47.9Hz #setting in bed slinger - pwm_cycle_time: 0.01666
pwm_cycle_time: 0.01666



# [bed_mesh]
# speed: 150
# mesh_min: 5,5
# mesh_max: 285,280
# probe_count: 6,6
# fade_start: 5.0
# fade_end: 50.0

[input_shaper]
#shaper_freq_x: 95.8 # center frequency for the X axis filter
#shaper_type_x: 3hump_ei # filter type for the X axis
#shaper_freq_y: 47.4 # center frequency for the Y axis filter
#shaper_type_y: mzv # filter type for the Y axis
damping_ratio_x: 0.058 # damping ratio for the X axis
damping_ratio_y: 0.058 # damping ratio for the Y axis


[adxl345]
cs_pin: Nozzle_MCU:PA4
spi_speed: 5000000
axes_map: x,-z,y #<--Current
# axes_map: x, -z, -y

spi_software_sclk_pin: Nozzle_MCU:PA5
spi_software_mosi_pin: Nozzle_MCU:PA7
spi_software_miso_pin: Nozzle_MCU:PA6

[resonance_tester]
accel_chip: adxl345
# accel_per_hz: 75
probe_points:
   150,150,25

[shaketune]
result_folder: /home/biqu/printer_data/config/Shaketune_results/ #~/home/biqu/printer_date/ShakeTune_results
number_of_results_to_keep: 5
keep_raw_data: False
show_macros_in_webui: True
timeout: 600
measurements_chunk_size: 2
max_freq: 200
dpi: 300

[filament_switch_sensor filament_sensor] # Stock filament sensor
pause_on_runout: true
switch_pin: PC15


[display_status]

[printer]
kinematics: corexy
max_velocity:600
max_accel:25000
minimum_cruise_ratio:0.2
max_z_velocity:20
square_corner_velocity:25
max_z_accel:300


[pause_resume]


[firmware_retraction]
retract_length: 0.1
retract_speed: 35
unretract_extra_length: 0
unretract_speed: 35

[include moonraker_obico_macros.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3275420.735,0.089844:3273478.433,0.129688:3271513.851,
#*# 	0.170313:3269635.259,0.210156:3267829.392,0.250000:3266049.383,
#*# 	0.289844:3264279.814,0.329688:3262512.242,0.370313:3260801.589,
#*# 	0.410156:3259154.843,0.450000:3257530.067,0.489844:3255941.929,
#*# 	0.529688:3254330.029,0.570313:3252761.330,0.610156:3251249.755,
#*# 	0.650000:3249689.593,0.689844:3248204.697,0.729688:3246686.095,
#*# 	0.770313:3245193.656,0.810156:3243727.973,0.850000:3242250.050,
#*# 	0.889844:3240835.145,0.929688:3239411.185,0.970313:3237994.169,
#*# 	1.010156:3236630.054,1.050000:3235235.903,1.089844:3233886.460,
#*# 	1.129688:3232532.732,1.170313:3231215.690,1.210156:3229971.315,
#*# 	1.250000:3228676.028,1.289844:3227444.483,1.329688:3226213.470,
#*# 	1.370313:3224995.319,1.410156:3223828.347,1.450000:3222652.917,
#*# 	1.489844:3221494.405,1.529688:3220331.792,1.570313:3219207.358,
#*# 	1.610156:3218106.696,1.650000:3217095.977,1.689844:3216061.326,
#*# 	1.729688:3215048.810,1.770313:3214048.024,1.810156:3213068.023,
#*# 	1.850000:3212115.771,1.889844:3211191.580,1.929688:3210274.168,
#*# 	1.970313:3209328.026,2.010156:3208470.469,2.050000:3207568.644,
#*# 	2.089844:3206755.468,2.129688:3205886.792,2.170313:3205062.352,
#*# 	2.210156:3204244.620,2.250000:3203444.479,2.289844:3202646.583,
#*# 	2.329688:3201870.896,2.370313:3201123.210,2.410156:3200388.072,
#*# 	2.450000:3199643.415,2.489844:3198952.544,2.529688:3198244.963,
#*# 	2.570313:3197555.732,2.610156:3196881.892,2.650000:3196229.855,
#*# 	2.689844:3195592.865,2.729688:3194941.442,2.770313:3194315.543,
#*# 	2.810156:3193728.436,2.850000:3193154.654,2.889844:3192557.354,
#*# 	2.929688:3192025.548,2.970313:3191459.373,3.010156:3190914.467,
#*# 	3.050000:3190359.575,3.089844:3189826.078,3.129688:3189308.463,
#*# 	3.170313:3188777.153,3.210156:3188298.157,3.250000:3187821.409,
#*# 	3.289844:3187327.961,3.329688:3186851.984,3.370313:3186384.589,
#*# 	3.410156:3185928.583,3.450000:3185467.070,3.489844:3185029.686,
#*# 	3.529688:3184559.478,3.570313:3184171.267,3.610156:3183747.943,
#*# 	3.650000:3183330.677,3.689844:3182941.661,3.729688:3182580.473,
#*# 	3.770313:3182158.937,3.810156:3181807.449,3.850000:3181432.420,
#*# 	3.889844:3181076.760,3.929688:3180710.480,3.970313:3180369.591,
#*# 	4.010156:3180002.491,4.050000:3179657.251
#*# calibration_temp = 33.678266
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 40.637907
#*# drift_calibration =
#*# 	3360644.758879, -2820.886709, 20.141917
#*# 	3312116.106386, -1917.541853, 13.291273
#*# 	3280785.269079, -1452.005080, 9.942133
#*# 	3254641.870347, -1078.779883, 7.344739
#*# 	3233018.012279, -766.656043, 5.120839
#*# 	3217331.514063, -566.449453, 3.719500
#*# 	3206315.982398, -447.902915, 2.893839
#*# 	3196462.484480, -315.789872, 1.917750
#*# 	3188997.100504, -225.906942, 1.284198
#*# drift_calibration_min_temp = 56.23536910126953
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.193798, -0.208084, -0.213976, -0.220932, -0.227063, -0.222549, -0.219521, -0.220966, -0.220284, -0.225933, -0.224907, -0.217640, -0.201306, -0.186152
#*# 	  -0.176160, -0.194717, -0.196977, -0.197099, -0.194187, -0.188968, -0.184554, -0.174994, -0.173171, -0.176935, -0.177945, -0.173249, -0.167962, -0.159318
#*# 	  -0.153976, -0.168694, -0.164157, -0.162028, -0.156780, -0.141646, -0.127134, -0.126795, -0.121396, -0.126617, -0.128479, -0.131967, -0.132279, -0.116001
#*# 	  -0.132325, -0.138424, -0.126504, -0.119930, -0.111813, -0.101012, -0.088789, -0.082459, -0.078255, -0.080303, -0.082375, -0.085384, -0.092575, -0.083859
#*# 	  -0.112280, -0.108307, -0.099839, -0.086489, -0.079842, -0.060860, -0.052534, -0.050136, -0.052625, -0.050309, -0.055622, -0.059865, -0.059639, -0.057214
#*# 	  -0.093617, -0.100928, -0.088843, -0.076021, -0.063318, -0.042764, -0.034950, -0.040214, -0.034034, -0.041332, -0.039027, -0.049814, -0.037431, -0.052685
#*# 	  -0.078711, -0.075773, -0.069815, -0.050775, -0.040448, -0.021642, -0.014573, -0.012249, -0.016776, -0.017791, -0.028135, -0.024646, -0.023169, -0.040283
#*# 	  -0.067342, -0.066705, -0.063446, -0.047541, -0.031301, -0.014119, -0.007677, 0.001341, -0.000426, -0.005071, -0.012557, -0.009375, -0.017279, -0.014693
#*# 	  -0.057009, -0.059660, -0.057674, -0.044036, -0.026597, -0.017224, -0.000881, 0.001989, 0.005473, -0.005197, -0.002205, -0.011525, -0.012535, -0.019609
#*# 	  -0.060688, -0.048949, -0.062825, -0.048718, -0.042315, -0.023312, -0.015080, 0.002125, 0.006472, 0.001656, 0.000646, 0.006071, -0.018228, -0.023359
#*# 	  -0.076303, -0.072772, -0.078063, -0.062217, -0.046197, -0.031089, -0.023909, -0.014841, 0.001214, 0.000926, -0.005651, -0.012550, -0.025059, -0.036071
#*# 	  -0.090871, -0.096778, -0.097002, -0.090293, -0.065976, -0.050918, -0.034941, -0.030498, -0.012065, -0.016128, -0.016811, -0.030786, -0.037623, -0.059367
#*# 	  -0.113346, -0.116312, -0.112168, -0.090848, -0.073148, -0.043662, -0.034174, -0.023213, -0.022287, -0.023185, -0.039803, -0.049391, -0.070114, -0.086779
#*# 	  -0.138267, -0.138940, -0.126195, -0.109899, -0.079693, -0.059706, -0.042367, -0.040851, -0.037375, -0.049516, -0.058271, -0.073191, -0.091465, -0.114592
#*# 	  -0.174139, -0.160796, -0.142608, -0.119732, -0.093223, -0.082315, -0.072367, -0.074239, -0.074914, -0.090052, -0.100443, -0.120685, -0.134455, -0.160821
#*# 	  -0.203373, -0.179924, -0.162986, -0.150607, -0.134988, -0.123225, -0.120692, -0.124707, -0.125583, -0.134600, -0.149262, -0.159905, -0.180861, -0.200127
#*# 	  -0.223098, -0.204841, -0.186902, -0.184547, -0.173246, -0.169279, -0.162846, -0.175051, -0.169656, -0.187990, -0.193145, -0.204831, -0.217316, -0.247770
#*# 	  -0.255281, -0.255250, -0.241711, -0.235701, -0.229407, -0.217858, -0.212701, -0.215373, -0.220671, -0.229429, -0.231614, -0.240366, -0.264285, -0.291185
#*# x_count = 14
#*# y_count = 18
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 280.0
#*# min_y = 24.0
#*# max_y = 265.90999999999997
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 98.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 48.6
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 43.970
#*# pid_ki = 1.192
#*# pid_kd = 405.626
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.069098, -0.009833, -0.059265
#*# compensation_start_x = 20.0
#*# compensation_end_x = 280.0
