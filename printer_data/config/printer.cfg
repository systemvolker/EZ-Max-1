

[include Fan-Control.cfg]
[include K1-Style-Sensorless.cfg]
[include Pucci_Macros.cfg]
[include printer_params.cfg]
[include shell_command.cfg]

# [include Eddy-NG2.cfg]
[include Demon_BTT_Eddy_Offset.cfg]


[include camera-control.cfg]

[include Start_Pause_Cancel_End/Line_Purge.cfg]
[include Start_Pause_Cancel_End/Pucci_Smart_Park.cfg]
[include Start_Pause_Cancel_End/Start.cfg]
[include Start_Pause_Cancel_End/Clean_Nozzle.cfg]
[include Start_Pause_Cancel_End/Pucci-mainsail.cfg]

[exclude_object]
[pause_resume]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_45000E000B504B5735313920-if00

[mcu Nozzle_MCU]
serial: /dev/serial/by-path/platform-xhci-hcd.4.auto-usb-0:1.2.2:1.0-port0
baud: 230400
restart_method: command

# host MCU service is preinstalled and ready to use with:
[mcu CB2]
serial: /tmp/klipper_host_mcu

[temperature_sensor Manta_E3EZ]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[verify_heater extruder]

[verify_heater heater_bed]
check_gain_time: 120
heating_gain: 1.0
hysteresis: 10

[virtual_sdcard]
path: /home/biqu/printer_data/gcodes

[gcode_arcs]
resolution: 0.3

[extruder]
max_extrude_only_distance: 1000.0
max_extrude_cross_section: 80
step_pin: Nozzle_MCU:PB1
dir_pin: Nozzle_MCU:PB0
enable_pin: !Nozzle_MCU:PB2
microsteps: 16
# gear_ratio: 6.25:1
# rotation_distance: 44.17725 #with gear ratio
#rotation_distance: 4.6212342 <------ Libra
rotation_distance: 6.77271225 #6.7965 #<---- Original (stable state)
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: Nozzle_MCU:PB7
sensor_type:Generic 3950 #EPCOS 100K B57560G104F
sensor_pin: Nozzle_MCU:PA0
pressure_advance: 0.04
pressure_advance_smooth_time: 0.027
#control: pid
#pid_kp: 24.373
#pid_ki: 2.196
#pid_kd: 67.634
min_temp: 0
max_temp: 315

[tmc2209 extruder]
uart_pin: Nozzle_MCU:PB11
tx_pin: Nozzle_MCU:PB10
uart_address: 3
run_current: 0.55
# run_current: 0.7 #bondtech extruder <----------Libra
sense_resistor: 0.150
stealthchop_threshold: 0
# interpolate: False
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 2
# driver_TOFF: 3
# driver_HEND: 0
# driver_HSTRT: 5

############################## AUTO-TUNE ################################

# [autotune_tmc stepper_x]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [autotune_tmc stepper_y]
# motor: Pucci-X-Y-Motors
# tuning_goal: performance
# extra_hysteresis: 0
# tbl: 1
# toff: 1
# sg4_thrs: 110
# # pwm_freq_target: 55e3
# voltage: 24

# [motor_constants Pucci-X-Y-Motors]
# # Coil resistance, Ohms
# resistance: 1.2
# # Coil inductance, Henries
# inductance: 0.0015
# # Holding torque, Nm
# holding_torque: 0.45
# # Nominal rated current, Amps
# max_current: 2.5
# # Steps per revolution (1.8deg motors use 200, 0.9deg motors use 400)
# steps_per_revolution: 400

############################## ^^ AUTO-TUNE ^^ ################################

[stepper_x]
dir_pin: PA10
step_pin: PA14
enable_pin: !PA13
microsteps: 16 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 305.90
position_min: -2
position_max: 305.90
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_x]
uart_pin:PB8
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PC4
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118


[stepper_y]
dir_pin: PA15 #!
step_pin: PC8
enable_pin: !PC14
microsteps: 16 #16
rotation_distance: 40
full_steps_per_rotation:400
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: -1
position_min: -1
position_max: 295
homing_speed: 60
homing_retract_dist:0

[tmc2209 stepper_y]
uart_pin:PC9
interpolate: False
run_current:1.4
sense_resistor: 0.110
diag_pin: PB0
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 0
# driver_HSTRT: 7
driver_SGTHRS: 118

[stepper_z]
step_pin: PD2
dir_pin: !PD4
enable_pin: !PD3
microsteps: 16
rotation_distance:8
gear_ratio: 64:20
endstop_pin:probe:z_virtual_endstop   #probe:z_virtual_endstop
# position_endstop: 0
position_max: 293
position_min: -5
homing_speed: 10
homing_retract_dist: 0
second_homing_speed: 5
homing_retract_speed: 10


[tmc2209 stepper_z]
uart_pin: PD0
run_current: 0.8
diag_pin: PC6
stealthchop_threshold: 0
sense_resistor: 0.110
# driver_IHOLDDELAY: 8
# driver_TPOWERDOWN: 20
# driver_TBL: 1
# driver_TOFF: 1
# driver_HEND: 2
# driver_HSTRT: 2
driver_SGTHRS: 0

[heater_bed]
heater_pin: PC7
sensor_type: NTC 100K MGB18-104F39050L32 #default: EPCOS 100K B57560G104F
sensor_pin: PA3
#control: pid
#pid_kp: 44.227
#pid_ki: 0.553
#pid_kd: 883.995
min_temp: 0
max_temp: 118
# pwm_cycle_time: 0.02088 # 47.9Hz #setting in bed slinger - pwm_cycle_time: 0.01666
pwm_cycle_time: 0.01666



# [bed_mesh]
# speed: 150
# mesh_min: 5,5
# mesh_max: 285,280
# probe_count: 6,6
# fade_start: 5.0
# fade_end: 50.0

[input_shaper]
#shaper_freq_x: 95.8 # center frequency for the X axis filter
#shaper_type_x: 3hump_ei # filter type for the X axis
#shaper_freq_y: 47.4 # center frequency for the Y axis filter
#shaper_type_y: mzv # filter type for the Y axis
damping_ratio_x: 0.058 # damping ratio for the X axis
damping_ratio_y: 0.058 # damping ratio for the Y axis


[adxl345]
cs_pin: Nozzle_MCU:PA4
spi_speed: 5000000
axes_map: x,-z,y #<--Current
# axes_map: x, -z, -y

spi_software_sclk_pin: Nozzle_MCU:PA5
spi_software_mosi_pin: Nozzle_MCU:PA7
spi_software_miso_pin: Nozzle_MCU:PA6

[resonance_tester]
accel_chip: adxl345
# accel_per_hz: 75
probe_points:
   150,150,25

[shaketune]
result_folder: /home/biqu/printer_data/config/Shaketune_results/ #~/home/biqu/printer_date/ShakeTune_results
number_of_results_to_keep: 5
keep_raw_data: False
show_macros_in_webui: True
timeout: 600
measurements_chunk_size: 2
max_freq: 200
dpi: 300

[filament_switch_sensor filament_sensor] # Stock filament sensor
pause_on_runout: true
switch_pin: PC15


[display_status]

[printer]
kinematics: corexy
max_velocity:600
max_accel:25000
minimum_cruise_ratio:0.2
max_z_velocity:20
square_corner_velocity:25
max_z_accel:300


[pause_resume]


[firmware_retraction]
retract_length: 0.1
retract_speed: 35
unretract_extra_length: 0
unretract_speed: 35

[include moonraker_obico_macros.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3272170.782,0.089844:3270270.013,0.129687:3268428.385,
#*# 	0.170312:3266583.586,0.210156:3264851.438,0.250000:3263138.920,
#*# 	0.289844:3261405.425,0.329687:3259732.983,0.370312:3258054.950,
#*# 	0.410156:3256433.229,0.450000:3254886.408,0.489844:3253338.053,
#*# 	0.529687:3251845.812,0.570312:3250322.070,0.610156:3248866.035,
#*# 	0.650000:3247411.153,0.689844:3245966.771,0.729687:3244494.703,
#*# 	0.770313:3243065.303,0.810156:3241653.299,0.850000:3240243.010,
#*# 	0.889844:3238836.355,0.929688:3237445.156,0.970313:3236032.287,
#*# 	1.010156:3234700.708,1.050000:3233378.361,1.089844:3232061.471,
#*# 	1.129688:3230753.653,1.170313:3229489.770,1.210156:3228231.020,
#*# 	1.250000:3227060.375,1.289844:3225830.156,1.329688:3224644.632,
#*# 	1.370313:3223502.065,1.410156:3222347.118,1.450000:3221288.064,
#*# 	1.489844:3220201.044,1.529688:3219121.641,1.570313:3218028.495,
#*# 	1.610156:3216985.744,1.650000:3215986.281,1.689844:3214987.793,
#*# 	1.729688:3214019.997,1.770313:3213042.267,1.810156:3212083.967,
#*# 	1.850000:3211196.204,1.889844:3210269.898,1.929688:3209373.103,
#*# 	1.970313:3208491.157,2.010156:3207621.596,2.050000:3206772.775,
#*# 	2.089844:3205924.576,2.129688:3205134.280,2.170313:3204302.510,
#*# 	2.210156:3203491.952,2.250000:3202736.544,2.289844:3201962.062,
#*# 	2.329688:3201200.965,2.370313:3200440.242,2.410156:3199690.978,
#*# 	2.450000:3198989.891,2.489844:3198281.167,2.529688:3197591.795,
#*# 	2.570313:3196920.297,2.610156:3196268.519,2.650000:3195644.233,
#*# 	2.689844:3195007.072,2.729688:3194397.189,2.770313:3193786.314,
#*# 	2.810156:3193179.710,2.850000:3192612.160,2.889844:3192040.645,
#*# 	2.929688:3191501.092,2.970313:3190918.611,3.010156:3190412.827,
#*# 	3.050000:3189888.211,3.089844:3189336.060,3.129688:3188852.664,
#*# 	3.170313:3188330.367,3.210156:3187820.848,3.250000:3187350.987,
#*# 	3.289844:3186872.519,3.329688:3186427.505,3.370313:3185953.746,
#*# 	3.410156:3185535.107,3.450000:3185088.456,3.489844:3184637.904,
#*# 	3.529688:3184205.591,3.570313:3183775.592,3.610156:3183401.828,
#*# 	3.650000:3182987.452,3.689844:3182624.870,3.729688:3182241.120,
#*# 	3.770313:3181851.115,3.810156:3181486.395,3.850000:3181149.157,
#*# 	3.889844:3180795.924,3.929688:3180424.023,3.970313:3180098.730,
#*# 	4.010156:3179764.327,4.050000:3179428.775
#*# calibration_temp = 33.678266
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 40.783862
#*# drift_calibration =
#*# 	3360644.758879, -2820.886709, 20.141917
#*# 	3312116.106386, -1917.541853, 13.291273
#*# 	3280785.269079, -1452.005080, 9.942133
#*# 	3254641.870347, -1078.779883, 7.344739
#*# 	3233018.012279, -766.656043, 5.120839
#*# 	3217331.514063, -566.449453, 3.719500
#*# 	3206315.982398, -447.902915, 2.893839
#*# 	3196462.484480, -315.789872, 1.917750
#*# 	3188997.100504, -225.906942, 1.284198
#*# drift_calibration_min_temp = 56.23536910126953
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.250086, -0.270030, -0.273624, -0.277933, -0.288362, -0.281157, -0.278271, -0.275530, -0.273723, -0.274987, -0.268419, -0.255774, -0.240335, -0.216521
#*# 	  -0.222599, -0.241414, -0.244784, -0.248032, -0.244433, -0.235136, -0.221548, -0.218615, -0.207270, -0.206720, -0.206402, -0.197231, -0.190228, -0.175356
#*# 	  -0.184582, -0.199418, -0.195702, -0.196262, -0.184235, -0.168814, -0.160596, -0.147645, -0.135423, -0.142440, -0.135199, -0.137267, -0.136402, -0.116088
#*# 	  -0.146067, -0.153717, -0.149394, -0.138358, -0.131431, -0.112239, -0.097680, -0.085538, -0.086005, -0.082301, -0.083028, -0.086460, -0.085069, -0.074400
#*# 	  -0.114134, -0.118830, -0.108561, -0.097414, -0.078183, -0.061719, -0.047949, -0.037500, -0.043349, -0.042395, -0.045202, -0.045196, -0.041450, -0.036801
#*# 	  -0.092441, -0.097016, -0.090887, -0.069628, -0.057466, -0.034247, -0.030149, -0.019496, -0.018134, -0.016955, -0.018665, -0.021094, -0.013582, -0.025211
#*# 	  -0.080107, -0.071483, -0.059648, -0.038059, -0.023407, -0.005474, 0.004580, 0.006918, 0.011224, 0.006954, 0.002525, 0.006656, 0.008315, 0.001707
#*# 	  -0.060262, -0.052895, -0.041260, -0.028461, -0.011419, 0.008144, 0.022252, 0.033262, 0.032602, 0.029092, 0.033126, 0.034687, 0.031117, 0.018863
#*# 	  -0.052121, -0.037560, -0.035876, -0.024768, -0.000859, 0.019306, 0.031148, 0.043004, 0.052712, 0.039425, 0.045444, 0.046768, 0.035529, 0.025792
#*# 	  -0.039256, -0.031972, -0.030162, -0.025274, -0.004361, 0.010519, 0.025064, 0.046324, 0.058177, 0.057329, 0.055331, 0.060515, 0.044787, 0.030460
#*# 	  -0.058241, -0.050634, -0.042102, -0.031498, -0.007727, 0.009621, 0.020736, 0.035079, 0.056619, 0.057572, 0.055680, 0.040589, 0.038071, 0.023153
#*# 	  -0.067430, -0.061126, -0.058289, -0.049307, -0.026397, 0.003762, 0.011058, 0.030528, 0.038906, 0.042110, 0.032809, 0.029602, 0.018344, 0.010233
#*# 	  -0.080226, -0.077571, -0.059555, -0.043891, -0.018125, 0.006888, 0.025516, 0.032341, 0.034545, 0.028116, 0.015763, 0.006652, -0.010543, -0.023051
#*# 	  -0.107129, -0.101377, -0.083065, -0.060408, -0.028587, -0.009316, 0.005701, 0.010844, 0.013441, 0.000891, -0.009714, -0.021611, -0.035964, -0.047096
#*# 	  -0.140946, -0.108938, -0.094375, -0.074619, -0.050943, -0.038977, -0.035741, -0.032068, -0.034985, -0.043247, -0.059308, -0.068565, -0.077364, -0.093722
#*# 	  -0.161677, -0.136240, -0.118405, -0.116025, -0.098811, -0.091130, -0.080738, -0.085243, -0.082954, -0.095727, -0.102145, -0.108543, -0.123292, -0.134158
#*# 	  -0.189249, -0.178461, -0.161390, -0.154543, -0.148862, -0.139288, -0.137028, -0.134636, -0.140705, -0.141705, -0.149546, -0.152420, -0.166160, -0.187415
#*# 	  -0.232351, -0.236514, -0.230289, -0.224016, -0.214480, -0.203792, -0.196237, -0.197141, -0.195886, -0.204528, -0.197352, -0.206909, -0.223783, -0.245389
#*# x_count = 14
#*# y_count = 18
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 280.0
#*# min_y = 24.0
#*# max_y = 274.91999999999996
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 98.0
#*# shaper_type_y = mzv
#*# shaper_freq_y = 48.6
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 43.970
#*# pid_ki = 1.192
#*# pid_kd = 405.626
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.069098, -0.009833, -0.059265
#*# compensation_start_x = 20.0
#*# compensation_end_x = 280.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 27.982
#*# pid_ki = 2.275
#*# pid_kd = 86.042
